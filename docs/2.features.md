# SleepyTube - Features Implementation Plan

## 1. MVP Feature List & Priority

### Phase 1: Core Sleep Protection (Week 1)
**Goal**: Deliver minimum viable sleep-safe audio experience

#### Feature 1.1: Basic Audio Stabilization â­â­â­
**Status**: Must Have  
**Effort**: 3 days  
**Dependencies**: None

**Scope**:
- WebAudio pipeline setup
- Dynamic range compressor (medium preset only)
- Brickwall limiter
- Basic bypass logic

**Success Criteria**:
- Volume spikes reduced by >80%
- No audible artifacts during normal playback
- <10ms processing latency

**Implementation**:
```javascript
// Minimum viable audio graph
Video â†’ MediaElementSource â†’ Compressor â†’ Limiter â†’ Destination
```

#### Feature 1.2: Sleep Mode Toggle Button â­â­â­
**Status**: Must Have  
**Effort**: 2 days  
**Dependencies**: None

**Scope**:
- Inject button next to YouTube CC button
- ON/OFF state with visual feedback
- Persist state in chrome.storage
- Smooth fade-in/out when toggling

**Success Criteria**:
- Button appears within 1 second of page load
- Works on watch page and shorts
- State persists across page navigation

**Implementation**:
- DOM injection via MutationObserver
- YouTube-matching icon and styling
- Event listeners for click handling

#### Feature 1.3: Configuration Storage â­â­
**Status**: Must Have  
**Effort**: 1 day  
**Dependencies**: None

**Scope**:
- chrome.storage.sync for user preferences
- Default configuration values
- Real-time sync across tabs

**Success Criteria**:
- Settings persist across browser restarts
- Changes sync within 2 seconds across tabs
- Graceful fallback if storage unavailable

---

### Phase 2: Enhanced Control (Week 2)
**Goal**: Add user customization and feedback

#### Feature 2.1: Compression Strength Slider â­â­â­
**Status**: Must Have  
**Effort**: 1 day  
**Dependencies**: Feature 1.1

**Scope**:
- Three presets: Light, Medium, Strong
- Control panel UI (overlay/popup)
- Real-time parameter updates

**Success Criteria**:
- Parameter changes apply within 100ms
- No audio glitches during adjustment
- Visual feedback of current setting

#### Feature 2.2: Sleep EQ (Frequency Softening) â­â­
**Status**: Should Have  
**Effort**: 2 days  
**Dependencies**: Feature 1.1

**Scope**:
- Three presets: Natural, Gentle, Ultra Soft
- High-frequency attenuation (8-16kHz)
- Low-frequency control (<80Hz)

**Success Criteria**:
- Subjective reduction in "harshness"
- Maintain speech intelligibility
- A/B test shows preference for "Gentle" preset

**Implementation**:
```javascript
// EQ chain
Source â†’ Low-shelf filter â†’ High-shelf filter â†’ Peaking filter â†’ ...
```

#### Feature 2.3: Control Panel UI â­â­
**Status**: Should Have  
**Effort**: 2 days  
**Dependencies**: Features 2.1, 2.2

**Scope**:
- Semi-transparent overlay panel
- Sliders for strength and EQ
- Close button and keyboard shortcuts
- Dark theme matching YouTube

**Success Criteria**:
- Panel opens within 200ms
- Smooth animations (60 FPS)
- Responsive to keyboard controls (Esc to close)

---

### Phase 3: Intelligence & Feedback (Week 3)
**Goal**: Add predictive features and user guidance

#### Feature 3.1: Auto Gain Control (AGC) â­â­â­
**Status**: Must Have  
**Effort**: 3 days  
**Dependencies**: Feature 1.1

**Scope**:
- Loudness measurement (RMS-based LUFS approximation)
- Slow gain adjustment toward target (-18 LUFS)
- Asymmetric attack/release (prevent pumping)

**Success Criteria**:
- Consistent loudness across videos (<3 dB variation)
- No audible "breathing" or pumping
- 60 FPS update rate without performance impact

#### Feature 3.2: Voice Focus Mode â­â­
**Status**: Should Have  
**Effort**: 3 days  
**Dependencies**: Feature 1.1, 2.2

**Scope**:
- Multiband split (Low/Mid/High)
- Speech detection in mid-band (300-3400 Hz)
- Sidechain ducking of background frequencies
- Configurable duck amount (0-12 dB)

**Success Criteria**:
- Improved speech clarity in noisy videos
- No artifacts when speech stops/starts
- Toggle option in control panel

#### Feature 3.3: Sleep Score Badge (MVP) â­â­
**Status**: Should Have  
**Effort**: 4 days  
**Dependencies**: None (standalone)

**Scope**:
- Calculate score for currently playing video
- Display badge overlay on player
- Tooltip with explanation
- Cache scores for 7 days

**Scoring Factors (MVP)**:
- Peak density (40% weight)
- Loudness range (30% weight)

**Success Criteria**:
- Score calculation completes within 5 seconds
- Badge appears within 1 second
- Hover tooltip shows breakdown

**Defer to Phase 4**:
- Thumbnail badges (requires homepage injection)
- Frequency harshness analysis (complex FFT)
- Speech rate estimation

---

### Phase 4: Polish & Expansion (Week 4)
**Goal**: Production-ready quality and extended features

#### Feature 4.1: Thumbnail Sleep Scores â­
**Status**: Nice to Have  
**Effort**: 3 days  
**Dependencies**: Feature 3.3

**Scope**:
- Inject badges on homepage/search thumbnails
- Lazy calculation (only visible thumbnails)
- Background score fetching
- Color-coded badges (Green/Yellow/Red)

**Success Criteria**:
- No performance impact on page scroll
- Scores appear within 2 seconds of thumbnail visibility
- Cache hit rate >80% after first page visit

#### Feature 4.2: Advanced Sleep Panel â­
**Status**: Nice to Have  
**Effort**: 2 days  
**Dependencies**: Features 3.1, 3.2

**Scope**:
- Real-time AGC gain indicator
- Peak event counter ("Spikes blocked: 12")
- Current loudness meter
- Advanced settings (attack/release tuning)

**Success Criteria**:
- Updates at 2 Hz (no jank)
- Informative without overwhelming
- Keyboard accessible

#### Feature 4.3: Onboarding Flow â­
**Status**: Nice to Have  
**Effort**: 2 days  
**Dependencies**: All core features

**Scope**:
- First-run tooltip on sleep button
- Optional 30-second ear calibration
- Feature tour (3-4 steps)

**Success Criteria**:
- <10% skip rate on first run
- Calibration completion >50%
- Tooltip dismissible without annoyance

---

## 2. Feature Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Phase 1: Core (Week 1)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ Audio Pipeline   â”‚ â† Foundation         â”‚
â”‚  â”‚ (Compressor +    â”‚                      â”‚
â”‚  â”‚  Limiter)        â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚           â”‚                                 â”‚
â”‚           â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sleep Mode       â”‚  â”‚ Storage       â”‚  â”‚
â”‚  â”‚ Toggle Button    â”‚  â”‚ Management    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Phase 2: Control (Week 2)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Strength Slider  â”‚  â”‚ Sleep EQ      â”‚  â”‚
â”‚  â”‚ (3 presets)      â”‚  â”‚ (3 presets)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                     â”‚           â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                      â–¼                       â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚            â”‚ Control Panel UI â”‚             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Phase 3: Intelligence (Week 3)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ AGC (Auto Gain)  â”‚  â”‚ Voice Focus   â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚ (Multiband)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Sleep Score (Video Player Badge)     â”‚  â”‚
â”‚  â”‚ - Peak density                       â”‚  â”‚
â”‚  â”‚ - Loudness range                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Phase 4: Polish (Week 4)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Thumbnail Badges                     â”‚  â”‚
â”‚  â”‚ (Homepage/Search integration)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Advanced Sleep Panel                 â”‚  â”‚
â”‚  â”‚ (Real-time metrics, diagnostics)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Onboarding Flow                      â”‚  â”‚
â”‚  â”‚ (First-run experience)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. MVP Launch Criteria

**Minimum features for v0.0.1 public release**:

### Must Have âœ…
- Audio stabilization (compressor + limiter)
- Sleep mode toggle button
- Compression strength presets (3 levels)
- Sleep EQ presets (3 levels)
- AGC (auto gain control)
- Configuration storage (chrome.storage)
- Control panel UI

### Should Have âš ï¸
- Voice Focus mode (multiband + ducking)
- Sleep Score (player badge only)
- Basic onboarding tooltip

### Nice to Have ğŸ’¡
- Thumbnail badges (defer to v0.1.0)
- Advanced panel metrics
- Ear calibration

### Launch Blockers ğŸš«
- No critical bugs (crashes, audio glitches, data loss)
- Performance acceptable on mid-range devices
- Works on latest Chrome stable release
- Privacy policy and ToS published

---

**Document Version**: 1.0  
**Last Updated**: 2026-02-06  
**Author**: SleepyTube Product Team
