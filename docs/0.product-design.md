# SleepyTube - Product Design Document

## 1. Product Vision

**Tagline**: Transform any YouTube video into a stable, gentle, and wake-safe audio experience for sleep.

**Core Value Proposition**: 
Users listening to YouTube while sleeping aren't consuming video content - they're seeking a low-arousal, predictable, and continuous sound environment. SleepyTube eliminates unpredictable audio stimuli (sudden volume spikes, jarring sounds, harsh frequencies) that disrupt sleep.

## 2. Problem Statement

Users who listen to YouTube content while sleeping face several critical issues:

### P0 - Critical (Direct wake-up triggers)
- **Sudden volume spikes**: Applause, laughter, sound effects, ads
- **Inconsistent volume**: Previous video quiet, next video suddenly loud
- **Dynamic range issues**: Soft whispers followed by loud emphasis

### P1 - Important (Discomfort & stimulation)
- **Harsh background music**: High frequency peaks, rumbling bass, reverb
- **Stimulating voice characteristics**: High-pitched voices, fast speech
- **Jarring transitions**: Intro/outro music, mid-video inserts

### P2 - Nice to have
- **Content pacing**: Fast speech preventing mental relaxation
- **Unexpected audio events**: Host suddenly raising voice

## 3. Target Users

### Primary User Persona: "The Sleep Listener"
- Age: 18-45
- Behavior: Regularly falls asleep with YouTube playing (ASMR, podcasts, ambient sounds, educational content)
- Pain Points: 
  - Wakes up startled by sudden sounds
  - Spends time finding "sleep-safe" content
  - Constantly adjusts volume before sleeping
- Desired Outcome: Consistent, gentle audio that helps sleep without interruption

## 4. Product Features & Priority

### 4.1 Core Features (MVP - P0)

#### Feature 1: Sleep Audio Engine
**Function**: Real-time audio processing to create predictable, stable sound

**Components**:
1. **Hard Limiter** (Brickwall protection)
   - Prevents any audio peak above threshold
   - Fast attack (2ms), moderate release (50ms)
   - Threshold: -1.0 dBFS

2. **Dynamic Range Compressor** (Volume smoothing)
   - Reduces difference between quiet and loud moments
   - Configurable strength: Light / Medium / Strong
   - Default: Medium (-24dB threshold, 4:1 ratio)

3. **Auto Gain Control (AGC)** (Volume consistency)
   - Slowly adjusts volume to maintain consistent loudness
   - Target: -18 LUFS (configurable)
   - Smooth attack/release to avoid "breathing" effect

4. **Transient Guard** (Sudden sound protection)
   - Detects and suppresses rapid volume changes
   - Identifies: clapping, laughter, sudden shouts
   - Fast response (<5ms attack)

**User Controls**:
- Toggle: Sleep Mode ON/OFF
- Slider: Stability Level (Light → Strong)
- Slider: Peak Protection Sensitivity

#### Feature 2: Sleep EQ (Sound Softening)
**Function**: Reduce harsh frequencies that stimulate arousal

**Processing**:
1. **High Frequency Attenuation**
   - Reduce 8kHz-16kHz range (sibilance, harshness)
   - Gentle roll-off (-3dB to -6dB)

2. **Low Frequency Control**
   - Reduce rumbling bass <80Hz (-3dB)
   - Maintain vocal clarity (250-3400Hz)

3. **Multiband Sidechain** (Voice Focus mode)
   - Detect speech energy in mid-band
   - Duck background frequencies when voice present
   - Configurable duck amount (0-12dB)

**User Controls**:
- Presets: Natural / Gentle / Ultra Soft
- Toggle: Voice Focus Mode
- Advanced: Custom EQ curve (future)

#### Feature 3: Unified Sleep Mode Toggle
**Location**: Injected into YouTube player controls (next to CC button)

**Design**:
- Icon: Equalizer bars (matching YouTube's icon style)
- States: 
  - OFF: Gray/transparent
  - ON: Blue/highlighted (YouTube accent color)
- Tooltip: "Sleep Mode - Stabilize audio for sleep"
- Right-click: Open advanced panel

### 4.2 Enhanced Features (P1)

#### Feature 4: Sleep Score System
**Function**: Help users quickly identify sleep-friendly content

**Calculation Factors**:
1. **Peak Density** (40% weight)
   - Count sudden volume spikes per minute
   - Higher peaks → lower score

2. **Loudness Range (LRA)** (30% weight)
   - Measure dynamic range variation
   - Wider range → lower score

3. **Frequency Harshness** (20% weight)
   - Energy in harsh frequency bands (8-12kHz)
   - More energy → lower score

4. **Speech Rate** (10% weight)
   - Estimate words per minute
   - Faster → lower score

**Display**:
- Score: 0-100 (shown as badge on video thumbnail)
- Color coding:
  - 80-100: Green (Sleep-friendly)
  - 50-79: Yellow (Moderate)
  - 0-49: Red (Not recommended)
- Explainer: "Score: 85 - Low peak density, gentle frequencies"

**UI Integration**:
- Badge overlay on thumbnails (home page, recommendations)
- Detailed breakdown in sleep panel
- One-click apply stronger settings for low-scored videos

#### Feature 5: Gradual Sleep Transition
**Function**: Automatically adjust audio as user falls asleep

**Behavior**:
1. **Fade-in on Enable** (5 seconds)
   - Smoothly apply processing to avoid jarring change

2. **Post-Sleep Volume Reduction** (Optional)
   - After 10 minutes, gradually lower volume 20%
   - Over 5 minutes to avoid detection

3. **Wake Protection**
   - If user interacts (pause, volume change, seek)
   - Offer "Resume Sleep Mode" notification

**User Controls**:
- Toggle: Auto-fade after 10/20/30 minutes
- Slider: Fade-down amount (0-50%)

### 4.3 Surprise Features (P1-P2)

#### Feature 6: Personalized Ear Calibration
**Function**: 30-second initial setup to match user sensitivity

**Process**:
1. Play 3-4 audio samples with different characteristics:
   - High frequency test (8kHz tone burst)
   - Dynamic range test (whisper → normal speech)
   - Bass test (low rumble)

2. User indicates comfort level for each
3. Generate personalized EQ and compression profile

**Value**: Creates "this app understands me" moment, increases retention

#### Feature 7: Sleep Journal & Analytics (Future)
**Function**: Track sleep sessions and refine recommendations

**Data Collected**:
- Videos played during sleep mode
- Total sleep mode hours
- Wake events (detected by interaction during sleep window)
- Comfort ratings (optional feedback)

**Output**:
- Weekly sleep report
- Content recommendations based on history
- "Sleep-safe playlists" curation

## 5. User Experience Design

### 5.1 Visual Design Principles

**Design System**: YouTube-native dark theme
- **Color Palette**:
  - Primary: YouTube Red (#FF0000) for sleep mode active state
  - Secondary: Dark gray (#212121) background
  - Accent: Light blue (#3EA6FF) for interactive elements
  - Text: White (#FFFFFF) and light gray (#AAAAAA)

- **Typography**: Roboto font family (YouTube standard)
- **Icons**: Material Design Icons, matching YouTube's style
- **Spacing**: 8px grid system (YouTube standard)

**No Emojis**: Only use professional icon fonts and SVG graphics

### 5.2 UI Component Specifications

#### Component 1: Sleep Mode Toggle Button
**Location**: YouTube player controls (right side, before settings gear)

**Visual Design**:
```
┌─────────────────┐
│  [≋≋≋]  Sleep   │  ← OFF state (gray)
└─────────────────┘

┌─────────────────┐
│  [≋≋≋]  Sleep   │  ← ON state (blue glow)
└─────────────────┘
```

**Behavior**:
- Single click: Toggle sleep mode
- Right-click / long-press: Open control panel
- Keyboard shortcut: Alt+S (configurable)

#### Component 2: Sleep Control Panel
**Trigger**: Right-click sleep button or click settings icon

**Layout**:
```
╔═══════════════════════════════════════╗
║  SleepyTube                    [×]    ║
╠═══════════════════════════════════════╣
║                                       ║
║  Sleep Mode: [ON]  [OFF]              ║
║                                       ║
║  Stability Level                      ║
║  Light ━━━━━●━━━━━ Strong            ║
║                                       ║
║  Sound Softening                      ║
║  ○ Natural  ●Gentle  ○ Ultra Soft    ║
║                                       ║
║  ☑ Voice Focus Mode                   ║
║     Music/SFX Ducking: -6 dB          ║
║     ━━━━●━━━━━                        ║
║                                       ║
║  ☐ Auto-fade after 15 min             ║
║                                       ║
║  [Advanced Settings]                  ║
║                                       ║
╚═══════════════════════════════════════╝
```

**Panel Styling**:
- Semi-transparent dark background (rgba(33, 33, 33, 0.95))
- Rounded corners (8px)
- Drop shadow for depth
- Smooth fade-in animation (200ms)
- Positioned above player controls, anchored to button

#### Component 3: Sleep Score Badge
**Location**: Video thumbnails (top-right corner)

**Visual Design**:
```
Video Thumbnail
┌──────────────────────┐
│                  [85]│ ← Green badge
│                      │
│                      │
└──────────────────────┘
```

**Color Coding**:
- 80-100: Green (#4CAF50)
- 50-79: Yellow (#FFC107)
- 0-49: Red (#F44336)

**Hover Tooltip**:
```
Sleep Score: 85
✓ Low peak density
✓ Gentle frequencies
⚠ Moderate volume range
```

#### Component 4: Quick Sleep Button (Thumbnail Overlay)
**Location**: Video thumbnail hover overlay (alongside Watch Later, etc.)

**Design**: Moon icon button that applies sleep mode when video starts

### 5.3 User Flows

#### Flow 1: First Time User
```
1. User installs extension
   ↓
2. Opens YouTube video
   ↓
3. Extension shows onboarding tooltip:
   "Click Sleep Mode to protect your sleep from sudden sounds"
   ↓
4. User clicks Sleep Mode button
   ↓
5. Audio processing starts (smooth fade-in)
   ↓
6. Mini notification: "Sleep Mode Active - Volume stabilized"
   ↓
7. [Optional] Show calibration prompt: "Take 30s to personalize?"
```

#### Flow 2: Regular Usage
```
1. User opens YouTube at bedtime
   ↓
2. Selects video (sees Sleep Score badge)
   ↓
3. Clicks video to play
   ↓
4. Extension auto-enables Sleep Mode (if configured)
   ↓
5. User adjusts settings if needed (right-click panel)
   ↓
6. Falls asleep with stable audio
```

#### Flow 3: Content Discovery
```
1. User browsing YouTube homepage
   ↓
2. Sleep Score badges visible on all thumbnails
   ↓
3. User filters by high-score content
   ↓
4. Hovers over thumbnail → sees detailed score breakdown
   ↓
5. Clicks video → Sleep Mode auto-applies optimal settings
```

## 6. Technical Constraints & Considerations

### 6.1 Platform Limitations
- **Chrome Extension Manifest V3**: Service workers, limited background processing
- **YouTube Player**: Encrypted media streams, need to intercept at AudioContext level
- **Mobile Safari**: Limited WebAudio API support (future consideration)

### 6.2 Performance Requirements
- **Latency**: <10ms processing delay (imperceptible)
- **CPU Usage**: <5% on modern systems (i5/Ryzen 5 or better)
- **Memory**: <50MB additional RAM usage

### 6.3 Privacy & Data
- **No Data Collection**: All processing local, no telemetry
- **Optional Analytics**: If user opts in, anonymized usage stats
- **No Content Recording**: Never store or transmit audio

## 7. Success Metrics

### 7.1 Engagement Metrics
- **Activation**: % of users who enable Sleep Mode within first 3 uses
- **Retention**: Daily/Weekly active users
- **Session Duration**: Average time Sleep Mode is active

### 7.2 Quality Metrics
- **Perceived Wake Events**: User feedback on being startled (goal: <1 per week)
- **Volume Adjustments**: Reduction in manual volume changes during sleep sessions
- **Content Discovery**: % of users utilizing Sleep Score for selection

### 7.3 User Satisfaction
- **NPS Score**: Net Promoter Score target: >50
- **Feature Satisfaction**: Rating for each feature (1-5 stars)
- **Support Tickets**: Issues related to audio quality (<2% of users)

## 8. Competitive Differentiation

### vs. YouTube's Built-in Stable Volume
- **More Aggressive**: Targets sleep safety, not just comfort
- **Customizable**: User can tune sensitivity and response
- **Frequency Control**: Adds EQ and voice focus
- **Proactive**: Sleep Score helps content discovery

### vs. Chrome Volume Extensions
- **Sleep-Specific**: Optimized for low-arousal state
- **Multi-Dimensional**: ust volume, but also frequency and transients
- **Intelligent**: Learns user preferences over time
- **Integrated**: Native YouTube UI integration

### vs. Offline Audio Processors (Auphonic)
- **Real-Time**: No pre-processing required
- **Seamless**: Works with any YouTube constantly
- **Free**: No per-video processing fees
- **Convenient**: No download/upload workflow

## 9. Future Roadmap (Post-MVP)

### Phase 2: Enhanced Intelligence
- Machine learning for event detection (laughter, applause, music drops)
- Adaptive learninrom user interactions
- Community-driven Sleep Score refinements

### Phase 3: Cross-Platform
- Mobile app (Android priority, iOS if fean- Support for other platforms (Twitch, Spotify, podcasts)
- Browser syncs across devices

### Phase 4: Social & Community
- Sharee "Sleep-Safe" playlists
- User reviews of content sleep-friendliness
- Creator tools: analyze own conter sleep-safety

## 10. Design Assets Needed

### Icons
- Sleep Mode icon (equalizer bars variant)
- Mooick sleep toggle)
- Calibration icon (ear/headphone)

### Illustrations
- Onboarding tutorial graphics
- Empty stao videos found, etc.)
- Calibration process visuals

### Animations
- Sleep Mode activation (gentle pulse)
- Panel transitions (smooth slide/fade)
- Score badge appearance (subtle scale-in)

---

**Document Version**: 1.0t Updated**: 2026-02-06  
**Author**: SleepyTube Product Team
