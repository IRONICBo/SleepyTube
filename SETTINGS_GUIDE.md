# SleepyTube 配置详解

## 📋 目录
- [界面概览](#界面概览)
- [核心功能](#核心功能)
- [音频处理设置](#音频处理设置)
- [语音增强设置](#语音增强设置)
- [音量控制设置](#音量控制设置)
- [推荐配置](#推荐配置)

---

## 🎛️ 界面概览

### 1. Header（顶部状态栏）
```
┌──────────────────────────────────────┐
│ 🎵 SleepyTube v1.3.0    ● Inactive  │
└──────────────────────────────────────┘
```

**状态指示器**：
- 🔴 **Inactive** - Sleep Mode 未启用
- 🟢 **Active** - Sleep Mode 正在运行，正在处理音频

### 2. Waveform Display（波形显示区）
```
┌──────────────────────────────────────┐
│ Before                         After │
│ ～～～～～～～～～～～～～～～～～～～ │  
│                                      │
│ ～～～～～～～～～～～～～～～～～～～ │
└──────────────────────────────────────┘
```

**功能**：
- 实时显示音频处理前后的波形对比
- **Before (红色)**: 原始音频信号
- **After (绿色)**: 处理后的音频信号
- 只有在打开 YouTube 视频时才会显示

---

## ⚡ 核心功能

### Sleep Mode（睡眠模式）主开关

```
┌──────────────────────────────────────┐
│ 🎵 Sleep Mode          [Toggle: ○→●] │
│    Click to enable                   │
└──────────────────────────────────────┘
```

**作用**：
- 启用/禁用整个音频处理系统
- 关闭状态：音频直接播放，不做任何处理
- 开启状态：激活所有音频优化功能

**使用建议**：
- ✅ 夜间观看视频时开启
- ✅ 看惊悚/动作片时开启
- ✅ 听播客/纪录片时开启
- ❌ 看音乐视频时可以关闭（保留原音质）

---

## 🎵 音频处理设置

### 1. Stability Level（稳定性级别）

**作用**：控制音量的稳定程度（动态范围压缩强度）

#### Light（轻度）
```
Ratio: 4:1
Threshold: -24 dB
适用场景：轻度压缩，保留较多动态
```
- **效果**：温和的音量平滑
- **动态范围**：保留 ~80%
- **适合**：
  - 高品质音乐视频
  - 音频制作精良的内容
  - 对音质要求高的用户

#### Medium（中度）⭐ **默认推荐**
```
Ratio: 8:1
Threshold: -30 dB
适用场景：平衡的音量控制
```
- **效果**：明显的音量稳定效果
- **动态范围**：保留 ~50%
- **适合**：
  - 大多数 YouTube 视频
  - 播客、访谈节目
  - 纪录片
  - 日常睡前观看

#### Strong（强力）
```
Ratio: 12:1
Threshold: -36 dB
适用场景：最大程度稳定音量
```
- **效果**：极强的音量压缩
- **动态范围**：保留 ~30%
- **适合**：
  - 惊悚/恐怖片（防止突然的尖叫声）
  - 动作片（防止爆炸声）
  - 音量波动很大的内容
  - 对安静环境要求极高时

**技术说明**：
- 使用 DynamicsCompressor 节点
- Attack: 0.003s (快速响应)
- Release: 0.25s (自然释放)
- Knee: 30 (平滑过渡)

---

### 2. Sound Character（声音特性）

**作用**：调整音频的频率特性，让声音更柔和舒适

#### Natural（自然）
```
频率调整：极少
适用场景：保持原声
```
- **低频 (100Hz)**：不调整
- **中频 (1000Hz)**：不调整
- **高频 (8000Hz)**：-2 dB（轻微削减）
- **适合**：
  - 喜欢原汁原味的用户
  - 音质优秀的内容

#### Gentle（柔和）⭐ **默认推荐**
```
频率调整：温和柔化
适用场景：舒适聆听
```
- **低频 (100Hz)**：-4 dB（减少低音轰鸣）
- **中频 (1000Hz)**：+2 dB（增强人声）
- **高频 (8000Hz)**：-6 dB（削减刺耳高音）
- **适合**：
  - 睡前放松
  - 长时间观看
  - 大多数内容

#### Soft（超柔和）
```
频率调整：最大程度柔化
适用场景：极度舒适
```
- **低频 (100Hz)**：-8 dB（大幅减少低音）
- **中频 (1000Hz)**：+4 dB（明显增强人声）
- **高频 (8000Hz)**：-10 dB（大幅削减高音）
- **适合**：
  - 噪音敏感用户
  - 深夜时段
  - 需要极度安静的环境
  - 耳朵疲劳时

**技术说明**：
- 使用 BiquadFilter 节点链
- 平滑的频率响应曲线
- 不会引入失真

---

## 🎤 语音增强设置

### 1. Voice Focus（语音聚焦）

**作用**：突出人声，降低背景音

**开启时**：
- 识别人声频段（300Hz - 3400Hz）
- 增强人声清晰度
- 激活背景音削减（Ducking）

**适合场景**：
- ✅ 访谈节目
- ✅ 演讲视频
- ✅ 教育内容
- ✅ 播客
- ✅ 新闻节目
- ❌ 音乐视频（会破坏音质）

### 2. Background Reduction（背景音削减）

**仅在 Voice Focus 开启时可用**

```
范围：0 dB → -12 dB
默认：-9 dB
```

**级别说明**：

#### 0 dB（不削减）
- 背景音保持原音量
- 仅增强人声

#### -3 dB（轻度削减）
- 背景音降低 30%
- 人声更突出

#### -6 dB（中度削减）
- 背景音降低 50%
- 适合有轻微背景音乐的内容

#### -9 dB（强力削减）⭐ **默认**
- 背景音降低 70%
- 人声非常突出
- 适合大多数访谈节目

#### -12 dB（最大削减）
- 背景音降低 75%
- 几乎只听到人声
- 适合背景音很吵的内容

**使用技巧**：
- 访谈节目：-6 到 -9 dB
- 新闻播报：-9 to -12 dB
- 有背景音乐的演讲：-3 to -6 dB

---

## 🔊 音量控制设置

### 1. Auto Gain Control（自动增益控制）

**作用**：让不同视频的音量保持一致

**开启时**：
- 自动分析视频的响度
- 调整到目标响度级别
- 不同视频间音量一致

**效果对比**：

**关闭 AGC**：
```
视频 A: 🔊🔊🔊🔊🔊🔊 (很响)
视频 B: 🔊🔊          (很轻)
需要手动调音量 ❌
```

**开启 AGC**：
```
视频 A: 🔊🔊🔊🔊      (自动降低)
视频 B: 🔊🔊🔊🔊      (自动提升)
音量统一，不需调整 ✅
```

**适合场景**：
- ✅ 播放列表自动播放
- ✅ 切换不同频道的视频
- ✅ 睡前观看（不用频繁调音量）

### 2. Target Loudness（目标响度）

**仅在 AGC 开启时可用**

```
范围：-24 LUFS → -12 LUFS
默认：-18 LUFS
```

**LUFS 是什么？**
- Loudness Units relative to Full Scale
- 国际标准的响度测量单位
- 数值越大 = 越响

**级别说明**：

#### -24 LUFS（极轻）
```
音量：■□□□□ (20%)
适合：深夜、浅睡眠
```

#### -21 LUFS（很轻）
```
音量：■■□□□ (40%)
适合：夜间、需要安静
```

#### -18 LUFS（适中）⭐ **默认推荐**
```
音量：■■■□□ (60%)
适合：大多数场景
参考：YouTube 标准响度
```

#### -15 LUFS（较响）
```
音量：■■■■□ (80%)
适合：白天观看
```

#### -12 LUFS（很响）
```
音量：■■■■■ (100%)
适合：嘈杂环境
参考：电视广播标准
```

**使用建议**：
- 深夜睡前：-21 到 -24 LUFS
- 日常观看：-18 LUFS
- 嘈杂环境：-12 to -15 LUFS

### 3. Output Volume（输出音量）

**作用**：整体音量的最终微调

```
范围：-12 dB → +12 dB
默认：0 dB
步进：1 dB
```

**使用场景**：

#### 负值（-12 to -1 dB）
```
降低整体音量
适合：
- 耳机音量太大
- 深夜观看
- 音量敏感用户
```

#### 0 dB（默认）
```
不调整，保持处理后的音量
适合：大多数情况
```

#### 正值（+1 to +12 dB）
```
提升整体音量
适合：
- 外放音量不够
- 视频本身音量很小
- 需要更大音量时
```

**警告**：
- ⚠️ +6 dB 以上可能导致失真
- ⚠️ 配合系统音量使用，不要单独调太高
- ⚠️ 建议优先调整 Target Loudness，这个作为微调

---

## 🎙️ 语速控制设置

### 1. Speech Rate Adjustment（语速调整）

**作用**：自动检测并调整播放速度，让快速说话变得更易听懂

**工作原理**：
```
实时检测 → 统计音节速率 → 计算调整倍率 → 平滑应用
```

**开启时**：
- 分析音频中的音节频率
- 与目标语速对比
- 自动调整播放速度（0.5x - 1.5x）
- 保持音调不变

**适合场景**：
- ✅ 语速很快的播客
- ✅ 急促的访谈节目
- ✅ 密集的教育内容
- ✅ 非母语学习
- ❌ 音乐视频（会破坏节奏）
- ❌ 已经很慢的内容

### 2. Target Speech Rate（目标语速）

**仅在 Speech Rate Adjustment 开启时可用**

```
可选项：Slow | Normal | Fast | Auto
默认：Normal (3.5 音节/秒)
```

**级别说明**：

#### Slow（慢速）
```
目标：2.5 音节/秒
适合：最大化理解度
用途：
- 非母语学习
- 复杂内容
- 需要记笔记时
```

#### Normal（正常）⭐ **默认推荐**
```
目标：3.5 音节/秒
适合：舒适聆听
用途：
- 大多数播客
- 一般访谈
- 日常观看
```

#### Fast（快速）
```
目标：4.5 音节/秒
适合：保持部分速度
用途：
- 时间紧张时
- 熟悉的内容
- 二次观看
```

#### Auto（自动）
```
目标：自适应（默认 3.5 音节/秒）
智能调整到最佳速率
```

### 3. 实时监控

**检测显示**：
```
Detected: 5.2 syl/s (very_fast)
          ↑           ↑
      音节速率    速度分类
```

**速度分类**：
- Very Slow: < 2.0 syl/s
- Slow: 2.0-3.0 syl/s
- Normal: 3.0-4.0 syl/s
- Fast: 4.0-5.0 syl/s
- Very Fast: > 5.0 syl/s

**播放倍率**：
```
Playback: 0.85x
          ↑
    实际播放速度
```

### 4. 调整示例

#### 快速播客 → 正常速度
```
检测：5.2 音节/秒 (very_fast)
目标：3.5 音节/秒 (normal)
调整：5.2 / 3.5 = 1.49x → 需要减速
应用：0.67x 播放速度 (慢 33%)
效果：更容易理解
```

#### 慢速讲座 → 正常速度
```
检测：2.3 音节/秒 (slow)
目标：3.5 音节/秒 (normal)
调整：2.3 / 3.5 = 0.66x → 需要加速
应用：1.5x 播放速度 (上限，快 50%)
效果：节省时间
```

#### 已经正常的对话
```
检测：3.4 音节/秒 (normal)
目标：3.5 音节/秒 (normal)
差异：< 10% 阈值
应用：1.0x (不调整)
效果：保持原速
```

### 5. 使用技巧

**检测准确性**：
- 需要 5+ 个音节初始检测
- 持续 10-15 秒达到稳定
- 清晰单人讲话效果最佳

**平滑调整**：
- 每 2 秒更新一次
- 单次最大变化 5%
- 避免突兀的速度变化

**调整限制**：
- 最小：0.5x（慢一倍）
- 最大：1.5x（快 50%）
- 防止过度变形（避免花栗鼠音效）

**性能影响**：
- CPU 增加：~1-2%
- 检测延迟：< 100ms
- 调整延迟：2-4 秒（平滑过渡）

### 6. 与其他功能配合

| 功能 | 兼容性 | 说明 |
|------|--------|------|
| **Voice Focus** | ✅ 推荐 | 增强清晰度 + 调整速度 |
| **AGC** | ✅ 完美 | 统一音量 + 舒适语速 |
| **EQ Settings** | ✅ 无冲突 | 柔和音质 + 适中速度 |
| **浏览器播放速度** | ⚠️ 冲突 | 二选一使用 |

### 7. Podcast 场景自动配置

**Podcast 模式**默认启用语速调整：
```yaml
Speech Rate: ✅ ON
Target Rate: Normal (3.5 syl/s)
Adjustment: 0.5x - 1.5x
```

适合：
- 快速访谈主持人
- 急促的新闻播报
- 密集的教育播客
- 语速不均的多人对话

---

## 🎯 推荐配置

### 场景 1：深夜睡前观看 🌙

```yaml
Sleep Mode: ✅ ON
Stability Level: Strong
Sound Character: Soft
Voice Focus: ❌ OFF
Auto Gain Control: ✅ ON
Target Loudness: -21 LUFS
Output Volume: -3 dB
```

**效果**：
- 音量非常稳定，不会被突然的声音吵醒
- 声音柔和舒适，不刺耳
- 不同视频音量一致
- 整体音量较轻

---

### 场景 2：观看惊悚/恐怖片 😱

```yaml
Sleep Mode: ✅ ON
Stability Level: Strong
Sound Character: Gentle
Voice Focus: ❌ OFF
Auto Gain Control: ✅ ON
Target Loudness: -18 LUFS
Output Volume: 0 dB
```

**效果**：
- 强力压缩防止突然的尖叫声
- 保持适度的音质
- 不会在安静场景后突然巨响

---

### 场景 3：播客/访谈节目 🎙️

```yaml
Sleep Mode: ✅ ON
Stability Level: Medium
Sound Character: Gentle
Voice Focus: ✅ ON
Background Reduction: -9 dB
Auto Gain Control: ✅ ON
Target Loudness: -18 LUFS
Output Volume: 0 dB
```

**效果**：
- 人声清晰突出
- 背景音乐不干扰
- 音量稳定一致

---

### 场景 4：音乐欣赏 🎵

```yaml
Sleep Mode: ❌ OFF
或
Sleep Mode: ✅ ON
Stability Level: Light
Sound Character: Natural
Voice Focus: ❌ OFF
Auto Gain Control: ❌ OFF
Output Volume: 0 dB
```

**效果**：
- 保留原始音质
- 最小化处理
- 或轻度压缩保持动态

---

### 场景 5：教育/学习内容 📚

```yaml
Sleep Mode: ✅ ON
Stability Level: Medium
Sound Character: Gentle
Voice Focus: ✅ ON
Background Reduction: -6 dB
Auto Gain Control: ✅ ON
Target Loudness: -15 LUFS
Output Volume: +2 dB
```

**效果**：
- 讲解清晰可听
- 音量适中，保持专注
- 背景音不分散注意力

---

## 🔧 技术细节

### 音频处理链路

```
原始音频
    ↓
[Source Analyser] ← 波形分析（Before）
    ↓
[EQ Filter] ← Sound Character
    ↓
[Compressor] ← Stability Level
    ↓
[Voice Focus Filter] ← Voice Enhancement (可选)
    ↓
[AGC Node] ← Auto Gain Control (可选)
    ↓
[Output Gain] ← Output Volume
    ↓
[Output Analyser] ← 波形分析（After）
    ↓
扬声器输出
```

### 性能影响

**CPU 使用**：
- 基础处理：~2-5% CPU
- 完整处理链：~5-10% CPU
- 对视频播放无明显影响

**延迟**：
- 处理延迟：< 10ms
- 人耳基本察觉不到

---

## ❓ 常见问题

### Q: 音量还是会突然变化？
**A**: 尝试将 Stability Level 调高到 Strong，并确保 Sleep Mode 已开启。

### Q: 声音听起来闷闷的？
**A**: 将 Sound Character 从 Soft 改为 Gentle 或 Natural。

### Q: 人声不够清晰？
**A**: 开启 Voice Focus，并调高 Background Reduction 到 -9 dB 或更高。

### Q: 不同视频音量差别太大？
**A**: 确保 Auto Gain Control 已开启，并调整 Target Loudness。

### Q: 音质变差了？
**A**: 
1. 将 Stability Level 降低到 Light
2. 将 Sound Character 改为 Natural
3. 关闭 Voice Focus
4. 或直接关闭 Sleep Mode

### Q: 处理后音量太小？
**A**: 
1. 提高 Target Loudness（如 -15 LUFS）
2. 增加 Output Volume（如 +3 dB）
3. 检查系统音量和 YouTube 播放器音量

---

## 📊 实时反馈

### Waveform Display 解读

**Before (红色波形)**：
```
～～～～～～～～  ← 波动大 = 动态范围大
———————————————  ← 波动小 = 音量稳定
```

**After (绿色波形)**：
```
—————  ← 稳定的波形 = 压缩生效
～～～  ← 仍有波动 = 保留部分动态
```

**理想状态**：
- Before: 波动较大
- After: 波动明显减小但不完全平直
- 两者都有波形 = 处理正常工作

---

## 💡 使用技巧

1. **从默认配置开始**
   - 先用默认设置体验
   - 根据感受微调

2. **观察波形变化**
   - 实时查看 Before/After 对比
   - 调整设置时观察绿色波形变化

3. **场景保存**
   - 为不同场景找到最佳配置
   - 扩展会自动记住你的设置

4. **逐步调整**
   - 一次只改一个参数
   - 能听出每个参数的作用

5. **测试内容**
   - 用动态范围大的视频测试（如动作片预告）
   - 用访谈节目测试 Voice Focus
   - 用播放列表测试 AGC

---

## 🎓 进阶理解

### 为什么需要音频压缩？

YouTube 视频音频质量参差不齐：
- 专业制作：动态范围 20-30 dB
- 个人上传：可能超过 40 dB
- 广告：通常很响

没有处理的结果：
```
安静对话: 🔊🔊         (音量 20)
突然爆炸: 🔊🔊🔊🔊🔊🔊🔊 (音量 90)
        ↓
被吵醒 😱
```

有压缩处理：
```
安静对话: 🔊🔊🔊     (提升到 40)
突然爆炸: 🔊🔊🔊🔊   (压制到 50)
        ↓
平稳舒适 😊
```

### LUFS vs dB 的区别

**dB (分贝)**：
- 物理音量单位
- 瞬时测量
- 不考虑人耳感知

**LUFS**：
- 响度单位
- 时间平均
- 符合人耳感知
- 广播标准

例子：
```
两个视频都是 70 dB
视频 A: 持续对话 → -18 LUFS
视频 B: 突然爆炸 → -12 LUFS
      ↓
视频 B 听起来更响
LUFS 更准确 ✅
```

---

**最后建议**：
- 🌙 睡前建议开启 Sleep Mode
- 🎵 听音乐时可以关闭或使用 Light + Natural
- 🎙️ 看播客/访谈时使用 Voice Focus
- 📊 随时查看波形了解处理效果
- 💾 设置会自动保存，切换视频仍然生效

祝您使用愉快！ 😴🎵
